<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="longfangsong"><title>GraphQL with Go Â· Blog</title><meta name="description" content="GraphQL
GraphQL æ˜¯ä¸€ä¸ªç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨åŸºäºç±»å‹ç³»ç»Ÿæ¥æ‰§è¡ŒæŸ¥è¯¢çš„æœåŠ¡ç«¯è¿è¡Œæ—¶ï¼ˆç±»å‹ç³»ç»Ÿç”±ä½ çš„æ•°æ®å®šä¹‰ï¼‰ã€‚GraphQL å¹¶æ²¡æœ‰å’Œä»»ä½•ç‰¹å®šæ•°æ®åº“æˆ–è€…å­˜å‚¨å¼•æ“ç»‘å®šï¼Œè€Œæ˜¯ä¾é ä½ ç°æœ‰çš„ä»£ç å’Œæ•°æ®æ”¯æ’‘ã€‚

ä¸è¦å› ä¸ºåå­—é‡Œå¸¦ä¸ªQLå°±æŠŠå®ƒå’Œæ•°æ®åº“è”æƒ³èµ·æ¥äº†ï¼Œæ— è®ºå¦‚ä½•QLåªä»£è¡¨å®ƒæ˜¯"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon-precomposed" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="stylesheet" href="../../../../css/style.css"><link rel="stylesheet" href="../../../../css/blog_basic.css"><link rel="stylesheet" href="../../../../css/font-awesome.min.css"><link rel="stylesheet" href="../../../../css/source-code-pro.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 4.2.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="../../../../images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Blog</a></h3><div class="description"><p>ç”Ÿå‘½æ˜¯ç°è‰²çš„ï¼Œè€Œç†è®ºä¹‹æ ‘å¸¸é’</p></div></div><div id="pirate" data-wordart-src="//cdn.wordart.com/json/685czi4rqil5" style="width: 100%;" data-wordart-show-attribution></div><script src="//cdn.wordart.com/wordart.min.js" async defer></script></div><ul class="social-links"><li><a href="http://github.com/longfangsong" target="_blank" rel="noopener"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me" target="_blank" rel="noopener"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole" target="_blank" rel="noopener"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_site_pv">æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡</span></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">é¦–é¡µ</a></li><li><a href="/about">å…³äº</a></li><li><a href="/tags">æ ‡ç­¾</a></li><li><a href="/archives">å½’æ¡£</a></li><li><a href="/links">å‹é“¾</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/logo.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h1><a>GraphQL with Go</a></h1></div><div class="post-content"><h2 id="GraphQL"><a class="headerlink" href="#GraphQL" title="GraphQL"></a>GraphQL</h2><blockquote>
<p>GraphQL æ˜¯ä¸€ä¸ªç”¨äº API çš„æŸ¥è¯¢è¯­è¨€ï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨åŸºäºç±»å‹ç³»ç»Ÿæ¥æ‰§è¡ŒæŸ¥è¯¢çš„æœåŠ¡ç«¯è¿è¡Œæ—¶ï¼ˆç±»å‹ç³»ç»Ÿç”±ä½ çš„æ•°æ®å®šä¹‰ï¼‰ã€‚GraphQL å¹¶æ²¡æœ‰å’Œä»»ä½•ç‰¹å®šæ•°æ®åº“æˆ–è€…å­˜å‚¨å¼•æ“ç»‘å®šï¼Œè€Œæ˜¯ä¾é ä½ ç°æœ‰çš„ä»£ç å’Œæ•°æ®æ”¯æ’‘ã€‚</p>
</blockquote>
<p>ä¸è¦å› ä¸ºåå­—é‡Œå¸¦ä¸ªQLå°±æŠŠå®ƒå’Œæ•°æ®åº“è”æƒ³èµ·æ¥äº†ï¼Œæ— è®ºå¦‚ä½•QLåªä»£è¡¨å®ƒæ˜¯ä¸€é—¨æŸ¥è¯¢è¯­è¨€ï¼ˆQuery Languageï¼‰ï¼Œå®ƒæ ¹æœ¬ä¸èƒ½ç›´æ¥ç¢°æ•°æ®åº“ã€‚</p>
<p>ï¼ˆä½ çœ‹çœ‹yamlï¼Œå°±å’Œhtmlé•¿å¾—ä¸€ç‚¹éƒ½ä¸åƒå¯¹ä¸å¯¹ï¼Œåå­—ä¸é‡è¦ã€‚ï¼‰</p>
<p>å¤§ä½“æ¥è¯´ï¼ŒGraphQLæ˜¯æƒ³è¦åšæ‰Restful APIçš„ã€‚</p>
<p>GraphQLæ˜¯ä¸€é—¨è¯­è¨€ï¼Œæœ‰ä¸€å®šçš„å¤æ‚æ€§ï¼Œåœ¨æ­¤ä¸è®²è§£å…¶è¯­æ³•ï¼Œè€Œåªåšæ¦‚å¿µä¸Šçš„è®²è§£ã€‚</p>
<p>è¦å­¦ä¹ å…¶è¯­æ³•çš„åŒå­¦ï¼Œå³è½¬<a href="http://graphql.cn/learn/" rel="noopener" target="_blank">å®˜ç½‘æ•™ç¨‹</a>ã€‚</p>
<h3 id="GraphQLçš„è¿ä½œè¿‡ç¨‹"><a class="headerlink" href="#GraphQLçš„è¿ä½œè¿‡ç¨‹" title="GraphQLçš„è¿ä½œè¿‡ç¨‹"></a>GraphQLçš„è¿ä½œè¿‡ç¨‹</h3><p>ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>åç«¯æ­å»ºGraphQLæœåŠ¡</li>
<li>å‰ç«¯å‘è¿™ä¸ªæœåŠ¡å‘é€GraphQLæŸ¥è¯¢å­—ç¬¦ä¸²</li>
<li>è¿™ä¸ªæœåŠ¡å‘åç«¯å…¶ä»–éƒ¨åˆ†æŸ¥è¯¢ä¸€æ•´ä¸ªGraphQLä¸­çš„â€œå¯¹è±¡â€ï¼ˆè¿™ä¸ªæ“ä½œå¯èƒ½ä¼šç»è¿‡ä»æ•°æ®åº“ä¸­æŸ¥è¯¢å€¼ç„¶åæ‹¼è£…æˆå¯¹è±¡è¿™ç§ï¼‰</li>
<li>GraphQLæœåŠ¡è¿”å›ï¼ˆä¸”ä»…è¿”å›ï¼‰å‰ç«¯è¯·æ±‚çš„å€¼ï¼ˆå¸¸è§ç”¨æ³•æ˜¯åŒ…è£¹åœ¨JSONä¸­è¿”å›ï¼‰</li>
</ul>
<p><img alt="Route" src="./Route.svg"/></p>
<p>å½“ç„¶é™¤äº†æŸ¥è¯¢ä¹‹å¤–ï¼ŒGraphQLä¹Ÿæä¾›äº†<code>input</code>å’Œ<code>mutation</code>æ¥åˆ›å»ºã€ä¿®æ”¹æ•°æ®ã€‚ç”¨æ³•ä»ç„¶è§<a href="http://graphql.cn/learn/queries/#mutations" rel="noopener" target="_blank">å®˜ç½‘æ•™ç¨‹</a>ã€‚</p>
<h2 id="å‰ç«¯ä½¿ç”¨GraphQL"><a class="headerlink" href="#å‰ç«¯ä½¿ç”¨GraphQL" title="å‰ç«¯ä½¿ç”¨GraphQL"></a>å‰ç«¯ä½¿ç”¨GraphQL</h2><p>æ²¡å•¥å¥½è¯´çš„ï¼Œç›´æ¥å‘åç«¯å¼€çš„GraphQLæœåŠ¡ä¸Šå‘é€æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œç„¶åç­‰ç€æ”¶å¯¹åº”çš„JSONæ•°æ®å°±è¡Œã€‚</p>
<p>è‡³äºå“ªç§ï¼ˆJSONï¼ŸTextï¼ŸFormDataï¼Ÿï¼‰è¿™ä¸ªæ²¡æœ‰è§„å®šï¼Œå’Œåç«¯çº¦å¥½äº†å°±è¡Œã€‚</p>
<p>å¦‚æœæœ‰é‰´æƒç›¸å…³çš„ä¸œè¥¿ï¼Œæ¯”å¦‚<code>JWT Token</code>ï¼Œåƒå¹³å¸¸ä¸€æ ·å‘ç»™åç«¯å°±è¡Œäº†ã€‚</p>
<p>ä¸è¿‡ï¼Œå‰ç«¯ç¡®å®éœ€è¦æŒæ¡GraphQLçš„è¯­æ³•â€¦â€¦æ‰€ä»¥æƒ³ç”¨çš„å‰ç«¯å¯ä»¥å»çœ‹ä¸€ä¸‹â€¦â€¦</p>
<h2 id="åç«¯ä½¿ç”¨GraphQLï¼ˆGoï¼‰"><a class="headerlink" href="#åç«¯ä½¿ç”¨GraphQLï¼ˆGoï¼‰" title="åç«¯ä½¿ç”¨GraphQLï¼ˆGoï¼‰"></a>åç«¯ä½¿ç”¨GraphQLï¼ˆGoï¼‰</h2><p>è¿™å¯æ˜¯è¦äº†äººè€å‘½äº†ã€‚</p>
<p>çœ‹çœ‹JSã€Pythoné‡ŒGraphQLçš„ä¼˜é›…å®ç°ï¼Œç”¨Goçš„åªèƒ½æ„Ÿå¹å½“åˆä¸ºä»€ä¹ˆè¦é€‰Goâ€¦â€¦</p>
<p>ï¼ˆä¸è¿‡ä½ ä»¬è¿™äº›ç”¨ JSã€Python çš„äººä¸€å®šä¼šåœ¨æ€§èƒ½ä¸Šè¢«Goç”¨æˆ·æ‰“çˆ†çš„ğŸ˜ï¼‰</p>
<p>ï¼ˆå–‚ï¼Œè®¿é—®é‡æ ¹æœ¬åˆ°ä¸äº†é‚£ä¸ªåœ°æ­¥å¥½å§â€¦â€¦ï¼‰</p>
<p>ä¸ç®¡æ€ä¹ˆæ ·ï¼Œè‡ªå·±é€‰çš„æŠ€æœ¯æ ˆè·ªç€ä¹Ÿè¦ç”¨å®Œã€‚</p>
<h3 id="è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“"><a class="headerlink" href="#è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“" title="è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“"></a>è¦ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“</h3><p>ç›®å‰ä¸»æµçš„Go+GraphQLåº“æ˜¯ï¼š<a href="github.com/graphql-go/graphql">graphql-go</a>ã€‚</p>
<p>ç”¨è¿‡Goçš„éƒ½çŸ¥é“æ€ä¹ˆå®‰è£…ï¼Œ<code>go get</code>ä¸€æŠŠæ¢­å°±æ˜¯ã€‚</p>
<h3 id="å®šä¹‰GraphQLç±»å‹"><a class="headerlink" href="#å®šä¹‰GraphQLç±»å‹" title="å®šä¹‰GraphQLç±»å‹"></a>å®šä¹‰GraphQLç±»å‹</h3><p>ç”¨<code>graphql.NewObject</code>æ¥å®šä¹‰GraphQLç±»å‹ã€‚</p>
<p>å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> UserInfoType = graphql.NewObject(graphql.ObjectConfig{</span><br/><span class="line">    Name:        <span class="string">"user"</span>,</span><br/><span class="line">    Description: <span class="string">"ç”¨æˆ·ä¿¡æ¯æè¿°"</span>,</span><br/><span class="line">    <span class="comment">// GraphQLç±»å‹userçš„IDå­—æ®µ</span></span><br/><span class="line">    Fields: graphql.Fields{</span><br/><span class="line">        <span class="string">"Id"</span>: &amp;graphql.Field{</span><br/><span class="line">            Description: <span class="string">"ç”¨æˆ·ID"</span>,</span><br/><span class="line">            Type:        graphql.Int,</span><br/><span class="line">        },</span><br/><span class="line">        <span class="string">"CardId"</span>: &amp;graphql.Field{</span><br/><span class="line">            Description: <span class="string">"ç”¨æˆ·æ ¡å›­å¡å·"</span>,</span><br/><span class="line">            Type:        graphql.String,</span><br/><span class="line">        },</span><br/><span class="line">        <span class="string">"NickName"</span>: &amp;graphql.Field{</span><br/><span class="line">            Description: <span class="string">"ç”¨æˆ·æ˜µç§°"</span>,</span><br/><span class="line">            Type:        graphql.String,</span><br/><span class="line">        },</span><br/><span class="line">    },</span><br/><span class="line">})</span><br/></pre></td></tr></table></figure>
<p>å…¶å®è¿™æ ·å°±å¾ˆä¸èˆ’æœï¼Œè¦æ˜¯èƒ½åƒjsonå’Œormä¸€æ ·åœ¨å®šä¹‰structçš„æ—¶å€™ç”¨åå¼•å·å†™å‡ºæ¥å°±å¥½äº†ã€‚</p>
<h3 id="å®šä¹‰GraphQLæŸ¥è¯¢"><a class="headerlink" href="#å®šä¹‰GraphQLæŸ¥è¯¢" title="å®šä¹‰GraphQLæŸ¥è¯¢"></a>å®šä¹‰GraphQLæŸ¥è¯¢</h3><p>åŒæ ·ç”¨<code>GraphQL.newObject</code>æ¥å®šä¹‰ï¼š</p>
<p>å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> QueryType = graphql.NewObject(graphql.ObjectConfig{</span><br/><span class="line">    Name: <span class="string">"Query"</span>,</span><br/><span class="line">    Fields: graphql.Fields{</span><br/><span class="line">        <span class="string">"UserInfo"</span>: &amp;graphql.Field{</span><br/><span class="line">            Description: <span class="string">"[ç”¨æˆ·ç®¡ç†] è·å–æŒ‡å®šç”¨æˆ·çš„ä¿¡æ¯"</span>,</span><br/><span class="line">            Type:        UserInfoType,</span><br/><span class="line">            Args: graphql.FieldConfigArgument{</span><br/><span class="line">                <span class="comment">// è¦æ±‚å‰ç«¯æŸ¥è¯¢æ—¶ä½¿ç”¨çš„å‚æ•°</span></span><br/><span class="line">                <span class="comment">// ä¾‹å¦‚è¿™ä¸ªæŸ¥è¯¢å°±è¦æ±‚å‰ç«¯å†™ï¼š</span></span><br/><span class="line">                <span class="comment">// UserInfo(userID:2) { ... }</span></span><br/><span class="line">                <span class="string">"userID"</span>: &amp;graphql.ArgumentConfig{</span><br/><span class="line">                    Description: <span class="string">"ç”¨æˆ·ID"</span>,</span><br/><span class="line">                    Type:        graphql.NewNonNull(graphql.Int),</span><br/><span class="line">                },</span><br/><span class="line">            },</span><br/><span class="line">            <span class="comment">// å®é™…çš„æŸ¥è¯¢é€»è¾‘</span></span><br/><span class="line">            Resolve: <span class="function"><span class="keyword">func</span><span class="params">(p graphql.ResolveParams)</span> <span class="params">(<span class="keyword">interface</span>{}, error)</span></span> {</span><br/><span class="line">                <span class="comment">// å¦‚æœè¦åšé‰´æƒï¼Œå¯ä»¥åœ¨è¿™é‡Œåš</span></span><br/><span class="line">                <span class="comment">// å¦‚è·å–jwt tokenï¼Œå¯ä»¥</span></span><br/><span class="line">                <span class="comment">// fmt.Println(p.Context.Value("token"))</span></span><br/><span class="line">                <span class="comment">// è¿™é‡Œçš„tokenè¦ä»å¤–é¢ä¼ å…¥</span></span><br/><span class="line">                <span class="comment">// ä¸‹é¢ä¼šè¯´</span></span><br/><span class="line">                userId := p.Args[<span class="string">"userID"</span>]</span><br/><span class="line">                <span class="comment">// è¿™é‡Œä½¿ç”¨beegoçš„ormï¼Œæ¢æˆå…¶ä»–ormæˆ–è€…raw SQLç”šè‡³ä»å†…å­˜ä¸­å–æ•°æ®éƒ½å¯ä»¥</span></span><br/><span class="line">                orm_ := orm.NewOrm()</span><br/><span class="line">                user := User{Id: <span class="keyword">uint64</span>(userId.(<span class="keyword">int</span>))}</span><br/><span class="line">                orm_.Read(&amp;user)</span><br/><span class="line">                <span class="comment">// æ³¨æ„è¿™é‡Œï¼Œä¸éœ€è¦ç®¡å‰ç«¯é—®æˆ‘ä»¬è¦çš„æ˜¯Idå­—æ®µã€CardIdå­—æ®µè¿˜æ˜¯ä¸¤ä¸ªéƒ½è¦</span></span><br/><span class="line">                <span class="comment">// æˆ‘ä»¬è¿”å›çš„å°±åªæ˜¯ä¸€ä¸ªuserå¯¹è±¡è€Œå·²</span></span><br/><span class="line">                <span class="keyword">return</span> user, <span class="literal">nil</span></span><br/><span class="line">            },</span><br/><span class="line">        },</span><br/><span class="line">    },</span><br/><span class="line">})</span><br/></pre></td></tr></table></figure>
<h3 id="å®šä¹‰GraphQLä¿®æ”¹"><a class="headerlink" href="#å®šä¹‰GraphQLä¿®æ”¹" title="å®šä¹‰GraphQLä¿®æ”¹"></a>å®šä¹‰GraphQLä¿®æ”¹</h3><p>åŒæ ·ç”¨<code>GraphQL.newObject</code>æ¥å®šä¹‰ï¼š</p>
<p>å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MutationType = graphql.NewObject(</span><br/><span class="line">    graphql.ObjectConfig{</span><br/><span class="line">        Name: <span class="string">"userMutation"</span>,</span><br/><span class="line">        Fields: graphql.Fields{</span><br/><span class="line">            <span class="string">"addUser"</span>: &amp;graphql.Field{</span><br/><span class="line">                Type: InfoType,</span><br/><span class="line">                Args: graphql.FieldConfigArgument{</span><br/><span class="line">                    <span class="string">"CardId"</span>: &amp;graphql.ArgumentConfig{</span><br/><span class="line">                        Description: <span class="string">"ç”¨æˆ·æ ¡å›­å¡å·"</span>,</span><br/><span class="line">                        Type:        graphql.String,</span><br/><span class="line">                    },</span><br/><span class="line">                    <span class="string">"NickName"</span>: &amp;graphql.ArgumentConfig{</span><br/><span class="line">                        Description: <span class="string">"ç”¨æˆ·æ˜µç§°"</span>,</span><br/><span class="line">                        Type:        graphql.String,</span><br/><span class="line">                    },</span><br/><span class="line">                },</span><br/><span class="line">                Resolve: <span class="function"><span class="keyword">func</span><span class="params">(p graphql.ResolveParams)</span> <span class="params">(<span class="keyword">interface</span>{}, error)</span></span> {</span><br/><span class="line">                    newUser := User{</span><br/><span class="line">                        CardId:   p.Args[<span class="string">"CardId"</span>].(<span class="keyword">string</span>),</span><br/><span class="line">                        NickName: p.Args[<span class="string">"NickName"</span>].(<span class="keyword">string</span>),</span><br/><span class="line">                    }</span><br/><span class="line">                    orm_ := orm.NewOrm()</span><br/><span class="line">                    orm_.Insert(&amp;newUser)</span><br/><span class="line">                    <span class="keyword">return</span> newUser, <span class="literal">nil</span></span><br/><span class="line">                },</span><br/><span class="line">            },</span><br/><span class="line">        },</span><br/><span class="line">    },</span><br/><span class="line">)</span><br/></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨"><a class="headerlink" href="#ä½¿ç”¨" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>å…ˆå®šä¹‰Schemaï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Schema, _ = graphql.NewSchema(</span><br/><span class="line">   graphql.SchemaConfig{</span><br/><span class="line">      Query:    models.QueryType,</span><br/><span class="line">      Mutation: models.MutationType,</span><br/><span class="line">   },</span><br/><span class="line">)</span><br/></pre></td></tr></table></figure>
<p>å†å†™HTTPHandlerFuctionï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> {</span><br/><span class="line">        requestContent, _ := ioutil.ReadAll(r.Body)</span><br/><span class="line">        <span class="comment">// æå–jwt</span></span><br/><span class="line">        token, _ := request.AuthorizationHeaderExtractor.ExtractToken(r)</span><br/><span class="line">        result := graphql.Do(graphql.Params{</span><br/><span class="line">            Schema:        Schema,</span><br/><span class="line">            RequestString: <span class="keyword">string</span>(requestContent),</span><br/><span class="line">            <span class="comment">// è¿™é‡Œæ˜¯æ’å…¥jwtç”¨äºé‰´æƒçš„æ“ä½œ</span></span><br/><span class="line">            Context:       context.WithValue(context.Background(), <span class="string">"token"</span>, token),</span><br/><span class="line">        })</span><br/><span class="line">        json.NewEncoder(w).Encode(result)</span><br/><span class="line">}</span><br/></pre></td></tr></table></figure>
<p>å³å¯ç”¨<code>ServeMux</code>çš„æ–¹å¼serveå‡ºå»ã€‚</p>

</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-09-02</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Go/" title="Go">Go </a><a class="tag" href="/tags/GraphQL/" title="GraphQL">GraphQL </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="../../../../http:/twitter.com/home?status=,http:/longfangsong.github.io/2018/09/01/GraphQL%20with%20Go/,Blog,GraphQL%20with%20Go,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="../../04/Haskell%E4%B8%8E%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" title="Haskellä¸å‡½æ•°å¼ç¼–ç¨‹">ä¸Šä¸€ç¯‡</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="../../../07/18/%E4%BB%8E%E8%BE%93%E5%85%A5%E5%9C%B0%E5%9D%80%E5%88%B0%E7%BD%91%E9%A1%B5%E7%9A%84%E5%91%88%E7%8E%B0%EF%BC%8C%E5%88%B0%E5%BA%95%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/" title="ä»è¾“å…¥åœ°å€åˆ°ç½‘é¡µçš„å‘ˆç°ï¼Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆ">ä¸‹ä¸€ç¯‡</a></li></ul></div><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js?v=undefined"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:false|| false, 
  app_id:'HcCTt2sXmRChcaE4nMoSibwJ-gzGzoHsz',
  app_key:'6eevqWRr7jsWPUavkkAQjIMi',
  placeholder:'éšä¾¿è¯´ç‚¹å•¥å§â€¦â€¦',
  path: window.location.pathname,
  avatar:'mm'
})</script><script src="https://cdn.bootcss.com/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ["\\(","\\)"]],
    displayMath: [['$$','$$'], ["\\[","\\]"]]
  }
});</script></div></div></div></div><script src="../../../../js/jquery.js"></script><script src="../../../../js/jquery-migrate-1.2.1.min.js"></script><script src="../../../../js/jquery.appear.js"></script></body></html>